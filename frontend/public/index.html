<!doctype html>
<html lang="en">
  <head>
    <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin" />
    <meta http-equiv="Cross-Origin-Embedder-Policy" content="require-corp" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Cross-Chain ETH Bridge â€” Private Metrics</title>
    <link rel="stylesheet" href="./styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
  </head>
  <body>
    <div id="toasts" class="toasts"></div>

    <!-- Wallet Modal -->
    <div id="walletModal" class="modal hide">
      <div class="modal__backdrop"></div>
      <div class="modal__panel">
        <div class="modal__header">
          <h3>Connect a wallet</h3>
          <button id="modalClose" class="iconbtn" aria-label="Close">âœ•</button>
        </div>
        <div class="modal__content">
          <button id="optMetaMask" class="walletopt">
            <span class="walletopt__icon">ğŸ¦Š</span>
            <span class="walletopt__title">MetaMask</span>
            <span id="mmStatus" class="walletopt__status"></span>
          </button>
          <a id="mmInstall" class="walletopt walletopt--link hide" href="https://metamask.io/download/" target="_blank" rel="noreferrer">
            ğŸ‘‰ Install MetaMask
          </a>
        </div>
      </div>
    </div>

    <!-- Progress Modal -->
    <div id="progressModal" class="modal hide" role="dialog" aria-modal="true">
      <div class="modal__backdrop"></div>
      <div class="modal__panel">
        <div class="modal__header">
          <h3>Processingâ€¦</h3>
          <button id="progressClose" class="iconbtn" aria-label="Close">âœ•</button>
        </div>
        <ol id="progressList" class="progress">
          <li data-step="enc">Encrypt</li>
          <li data-step="send">Send</li>
          <li data-step="confirm">Confirm</li>
          <li data-step="decrypt">Decrypt</li>
        </ol>
      </div>
    </div>

    <!-- Top Bar -->
    <header class="topbar">
      <div class="topbar__left">
        <a class="brand" href="#">
          <span class="brand__dot"></span>
          <span class="brand__name">Cross-Chain ETH Bridge â€” Private Metrics</span>
          <span class="brand__badge">ZAMA FHEVM</span>
        </a>
      </div>
      <div class="topbar__right">
        <span id="pillNetwork" class="chip chip--muted">Network: â€“</span>
        <span id="pillAddress" class="chip chip--ghost hide">â€“</span>
        <div class="wallet">
          <button id="btnWallet" class="btn btn--primary">Connect</button>
          <div id="walletMenu" class="dropdown hide">
            <button id="btnDisconnect" class="dropdown__item">Disconnect</button>
          </div>
        </div>
      </div>
    </header>

    <main class="wrap">
      <!-- HERO -->
      <section class="card card--hero">
        <div class="card__head">
          <h1 class="card__title">Bridge ETH &amp; keep metrics private</h1>
          <div class="row gap">
            <span id="pillContract" class="chip mono">â€”</span>
          </div>
        </div>

        <!-- KPI row -->
        <div class="kpi">
          <div class="tile">
            <div class="t-label">
              Sâ†’B Volume (ETH)
              <span class="tip" data-tip="Encrypted total Sâ†’B volume, decryptable only by you.">ğŸ›ˆ</span>
            </div>
            <div id="vSB" class="t-num">â€”</div>
          </div>
          <div class="tile">
            <div class="t-label">
              Sâ†’B Transfers
              <span class="tip" data-tip="Encrypted total Sâ†’B transfers, decryptable only by you.">ğŸ›ˆ</span>
            </div>
            <div id="cSB" class="t-num">â€”</div>
          </div>
          <div class="tile">
            <div class="t-label">
              Bâ†’S Volume (ETH)
              <span class="tip" data-tip="Encrypted total Bâ†’S volume, decryptable only by you.">ğŸ›ˆ</span>
            </div>
            <div id="vBS" class="t-num">â€”</div>
          </div>
          <div class="tile">
            <div class="t-label">
              Bâ†’S Transfers
              <span class="tip" data-tip="Encrypted total Bâ†’S transfers, decryptable only by you.">ğŸ›ˆ</span>
            </div>
            <div id="cBS" class="t-num">â€”</div>
          </div>
          <div class="tile">
            <div class="t-label">
              Sâ†’B Public Volume (Snapshot)
              <span class="tip" data-tip="Publicly revealed when k-anonymity is satisfied.">ğŸ›ˆ</span>
            </div>
            <div id="pvSB" class="t-num">â€”</div>
          </div>
          <div class="tile">
            <div class="t-label">
              Bâ†’S Public Volume (Snapshot)
              <span class="tip" data-tip="Publicly revealed when k-anonymity is satisfied.">ğŸ›ˆ</span>
            </div>
            <div id="pvBS" class="t-num">â€”</div>
          </div>
        </div>

        <!-- Charts row -->
        <div class="charts">
          <div class="chart">
            <div class="chart__head">
              Volume Split (ETH)
              <span class="tip" data-tip="Share of Sâ†’B vs. Bâ†’S volumes.">ğŸ›ˆ</span>
            </div>
            <canvas id="splitChart" height="120"></canvas>
            <div class="contract chip">Contract: <span id="contractMini" class="mono"></span></div>
          </div>
          <div class="chart">
            <div class="chart__head">
              Transfers Split
              <span class="tip" data-tip="Number of transfers Sâ†’B vs. Bâ†’S.">ğŸ›ˆ</span>
            </div>
            <canvas id="countChart" height="120"></canvas>
          </div>
          <div class="chart">
            <div class="chart__head">
              Volume Trend (local)
              <span class="tip" data-tip="Each refresh appends a new point.">ğŸ›ˆ</span>
            </div>
            <canvas id="trendChart" height="120"></canvas>
          </div>
        </div>
      </section>

      <!-- ANALYTICS â€” Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ°Ñ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ°, ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚ Ñ†ĞµĞ½Ñ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ -->
      <section class="card card--analytics">
        <div class="center">
          <h3 class="sub">Analytics (private) â€” by direction</h3>
          <div class="row gap" style="margin-bottom:8px">
            <button id="btnRefreshAnalytics" class="btn btn--ghost tiny">ğŸ“ˆ Refresh analytics</button>
          </div>

          <!-- Sâ†’B KPI line -->
          <div class="kpi kpi--compact">
            <div class="tile">
              <div class="t-label">
                Sâ†’B 24h Volume
                <span class="tip" data-tip="Sum of your Sâ†’B amounts over the last 24 hours.">ğŸ›ˆ</span>
              </div>
              <div id="sb24v" class="t-num">â€”</div>
            </div>
            <div class="tile">
              <div class="t-label">
                Sâ†’B 7d Volume
                <span class="tip" data-tip="Sum of your Sâ†’B amounts over the last 7 days.">ğŸ›ˆ</span>
              </div>
              <div id="sb7dv" class="t-num">â€”</div>
            </div>
            <div class="tile">
              <div class="t-label">
                Sâ†’B Median
                <span class="tip" data-tip="Middle value of your Sâ†’B sizes over the last 7 days.">ğŸ›ˆ</span>
              </div>
              <div id="sbMed" class="t-num">â€”</div>
            </div>
            <div class="tile">
              <div class="t-label">
                Sâ†’B P90
                <span class="tip" data-tip="90% of your Sâ†’B transfers are â‰¤ this size (7d).">ğŸ›ˆ</span>
              </div>
              <div id="sbP90" class="t-num">â€”</div>
            </div>
          </div>

          <!-- Bâ†’S KPI line -->
          <div class="kpi kpi--compact">
            <div class="tile">
              <div class="t-label">
                Bâ†’S 24h Volume
                <span class="tip" data-tip="Sum of your Bâ†’S amounts over the last 24 hours.">ğŸ›ˆ</span>
              </div>
              <div id="bs24v" class="t-num">â€”</div>
            </div>
            <div class="tile">
              <div class="t-label">
                Bâ†’S 7d Volume
                <span class="tip" data-tip="Sum of your Bâ†’S amounts over the last 7 days.">ğŸ›ˆ</span>
              </div>
              <div id="bs7dv" class="t-num">â€”</div>
            </div>
            <div class="tile">
              <div class="t-label">
                Bâ†’S Median
                <span class="tip" data-tip="Middle value of your Bâ†’S sizes over the last 7 days.">ğŸ›ˆ</span>
              </div>
              <div id="bsMed" class="t-num">â€”</div>
            </div>
            <div class="tile">
              <div class="t-label">
                Bâ†’S P90
                <span class="tip" data-tip="90% of your Bâ†’S transfers are â‰¤ this size (7d).">ğŸ›ˆ</span>
              </div>
              <div id="bsP90" class="t-num">â€”</div>
            </div>
          </div>

          <!-- Per-dir pies -->
          <div class="charts charts--analytics">
            <div class="chart">
              <div class="chart__head">
                Sâ†’B Size Mix (last 7d)
                <span class="tip" data-tip="Small < Median, Medium [Median,P90), Large â‰¥ P90 for your last 7d.">ğŸ›ˆ</span>
              </div>
              <canvas id="sizeChartSB" height="120"></canvas>
            </div>
            <div class="chart">
              <div class="chart__head">
                Bâ†’S Size Mix (last 7d)
                <span class="tip" data-tip="Small < Median, Medium [Median,P90), Large â‰¥ P90 for your last 7d.">ğŸ›ˆ</span>
              </div>
              <canvas id="sizeChartBS" height="120"></canvas>
            </div>
          </div>
        </div>
      </section>

      <!-- 2 columns -->
      <section class="grid">
        <!-- Left: Bridge panel -->
        <section class="card">
          <div class="segmented" style="margin-bottom:12px; width:max-content;">
            <button id="segDeposit" class="segmented__btn is-active">ğŸ›¬ Deposit to Base Sepolia</button>
            <button id="segWithdraw" class="segmented__btn">ğŸ›« Withdraw to Sepolia</button>
            <div class="segmented__thumb"></div>
          </div>

          <div class="field">
            <label class="label">Amount (ETH) <button id="btnMax" class="linkbtn" type="button">MAX</button></label>
            <input id="amtEth" type="text" placeholder="e.g., 0.05" />
            <div id="amtBalance" class="hint">Balance: â€”</div>
          </div>

          <div class="row gap">
            <button id="btnDoBridge" class="btn">ğŸ§º Bridge &amp; Record</button>
          </div>

          <div class="hint" style="margin-top:10px">
            Note: after bridging, the app encrypts the same amount and records it to <b>MetricsHub</b> on Sepolia
            as a private metric (sum &amp; count). Individual transfers remain hidden.
          </div>

          <hr class="sep" />
          <h3 class="sub">L2 â†’ L1 Finalization</h3>
          <div class="hint" style="margin-top:10px">
            Note: Prove/Finalize are L1 transactions and require Sepolia ETH for gas.
          </div>
          <div id="finalStatus" class="status">No pending withdrawals yet.</div>
          <div class="row gap" style="margin-bottom:8px">
            <button id="btnRefreshFinal" class="btn btn--ghost tiny">ğŸ”„ Refresh</button>
            <button id="btnFinalizeAll" class="btn btn--ghost tiny">âœ… Finalize all ready</button>
          </div>
          <div id="finalList" class="history history--scrollable"></div>
        </section>

        <!-- Right: HISTORY -->
        <section class="card">
          <h3 class="sub" id="histTitle">My history â€” Sepolia â†’ Base Sepolia</h3>
          <div class="row gap" style="margin-bottom:10px">
            <button id="btnRefreshHist" class="btn">ğŸ“œ Refresh history</button>
          </div>
          <div id="histStatus" class="status">Connect a wallet to load history.</div>
          <div id="histList" class="history history--scrollable"></div>
        </section>
      </section>

      <!-- BOTTOM: READS / PUBLISH -->
      <section class="card" style="margin-top:16px;">
        <div class="segmented" style="margin-bottom:12px; width:max-content;">
          <button id="segSB" class="segmented__btn is-active">ğŸŸ¡ Sepolia â†’ Base Sepolia</button>
          <button id="segBS" class="segmented__btn">ğŸ”µ Base Sepolia â†’ Sepolia</button>
          <div class="segmented__thumb"></div>
        </div>

        <div class="row gap" style="margin-bottom:10px">
          <button id="btnPrivateRead" class="btn">ğŸ” Private read (Totals)</button>
          <button id="btnPublicRead" class="btn btn--ghost">ğŸ” Public read (Snapshots)</button>
        </div>

        <hr class="sep" />
        <label class="label">k-anonymity (min transfers to reveal)</label>
        <input id="kAnon" type="number" min="1" step="1" value="5" />

        <div class="row gap" style="margin-top:8px">
          <button id="btnPublish" class="btn">ğŸ“£ Publish snapshot</button>
        </div>

        <hr class="sep" />
        <div id="status" class="status">Connect a wallet to start.</div>
      </section>
    </main>

    <script type="module" src="./js/config.js"></script>
    <script type="module" src="./js/app.js"></script>
  </body>
</html>
